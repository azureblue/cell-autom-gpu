<html>
    <head>
        <title>cellular automata simulation</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes" />
        <link rel="shortcut icon" href="">
        <style>
            * {border: 0px; width: 100%; height: 100%; margin: 0px;}
            canvas {position: absolute; background: transparent;}
        </style>
        <script src="board.js"></script>
        <script src="mathutils.js"></script>
        <script src="geom.js"></script>
        <script src="color.js"></script>
        <script src="ca.js"></script>

        <script>
            function updateCanvasSize() {
                var canvas = document.getElementById("canvas");
                canvas.width = canvas.clientWidth;
                canvas.height = canvas.clientHeight;
            }
            
            function createParamMap() {
                var map = {};
                var params = window.location.search.substr(1).split("&");
                params.forEach(par => {
                    var kv = par.split("=");
                    map[kv[0]] = kv[1];
                });
                return map;  
            };
            
            function start() {
                updateCanvasSize();
                var frame = 0;
                var board = new Board(1000, 1000);
                var b = 0;
                
                board.iteratePositions((x, y) => 
                    board.set(x, y, randomBool() ? 1 : 0)
                );
        
                var ca = new CA(document.getElementById("canvas"), 2048, 1024, 2047, 1023);
                var params = createParamMap();
                if (params.rule !== undefined)
                    ca.setRule(params.rule);
                ca.updateSize();
                ca.setZoom(1);
                ca.setCenter(1024, 512);
                ca.putBoard(board, 523, 10);
                
                window.addEventListener("resize", resizeCallback);
              
                nextIteration();
                
                function resizeCallback() {
                    updateCanvasSize();
                    ca.updateSize();
                }
                
                window.addEventListener("keydown", function(evt) {
                    switch (evt.key) {
                        case " ":
                            iterating = !iterating;
                            break;
                        case "Shift":
                        case "i":
                            ca.iterate();
                    }
                });
                
                var iterating = true;
                
                function nextIteration() {
                    frame++;                    
                    if (frame % 2 === 0) {
                        ca.render();
                        if (iterating)
                            ca.iterate();
                    }
                    window.requestAnimationFrame(nextIteration);
                }
            }
            
            
        </script>
    </head>
    <body onload="start()">
        <canvas id="canvas"></canvas>
    </body>
</html>
